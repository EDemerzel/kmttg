=USING KMTTG=
NOTE: The first time you start kmttg you may be prompted to allow 3rd party tool download and installation which are used by kmttg as well as prompted for your Media Access Key (MAK). You can further configure kmttg as needed by selecting *File->Configure…* menu entry. See the [http://code.google.com/p/kmttg/wiki/configuring_kmttg configuring_kmttg] wiki documentation for details on configuration options.

Hopefully, the kmttg GUI is pretty intuitive to use. For more information on the Auto Transfers mode see the section further below. A little guidance is provided for basic usage of the GUI mode:

==DOWNLOADING FROM TIVOS==
1. Use the *TIVO* cyclic to select which Tivo you want to download shows from. By default the first entry is always *FILES* which allows you to find files on your computer to use as a starting point for kmttg (see documentation on this a little further down). Additionally any Tivos you have previously configured for kmttg will show up in this list so that you can use shows on your Tivos as starting points for kmttg.
NOTE: Shows that are still recording or are copy protected are marked as such and displayed differently by kmttg and cannot be downloaded.
NOTE: You can sort shows in the list by clicking on the list headers:

    * Clicking on 1st column header button you can sort shows by expiration type.
    * Clicking on the *DATE* header button you can sort shows by earliest or latest date first.
    * Clicking on the *CHANNEL* header button you can sort shows by lowest or highest channel number.
    * Clicking on the *SIZE* header button you can sort shows by smallest or largest file size first.
    * Clicking on the *SHOW* header button you can sort shows alphabetically or reverse alphabetically by show name.

2. Select 1 or more shows in the SHOW list that you wish to download. You can select multiple entries at once. Ctrl+left click toggles individual selections without losing your selection list.

3. Enable actions you would like to perform on the selected list of shows. The actions (in order that they are generally performed) are:
===metadata===
  * If this option is enabled then kmttg will create a metadata file which will have same file name as the final video file name but with .txt extension at the end.
  * This metadata file can be used by *pyTivo* when serving back shows on your PC to your Tivos to provide detailed information about the show. Without the metadata file if you serve .mpg (or non `.TiVo` files) back to your Tivos there will be no information about the shows when you view them from your Tivos.<br>
  NOTE: According to pyTivo conventions this file should be the same name as your video file but with .txt extension added. Thus if you re-name your video file be sure to re-name this file as well.

===decrypt===
  * Shows downloaded from your Tivos are encrypted mpeg2 program files saved with `.TiVo` file extension.
  * With this option enabled kmttg will use tivodecode to decrypt `.TiVo` files to unencrypted mpeg2 program files with .mpg extension.
  * Most often you will want this option enabled.

===VRD QS Fix===
  * This option is short for `VideoRedo` Quickstream Fix.
  * If you plan on any further processing of .mpg files such as cutting out commercials or re-encoding to different format it’s useful to run the file through VRD QS fix first to fix any potential glitches in the .mpg file that may cause issues.

===comskip===
  * comskip is a public domain program that can scan an mpeg2 file and detect commercials.
  * With default configuration it will produce a .edl file which can be fed to *mencoder* to cut out detected commercial segments.
  NOTE: If you have VRD enabled then you should edit *comskip.ini* file and set:<br>*output_videoredo=1*<br>
  * By doing so the comskip step will create a .VPrj file which contains the cut sections for `VideoRedo` to be used in the comcut stage.
NOTE: comskip can be configured to output several other files too such as a bookmark .mls file for Womble Mpeg Video Wizard or a cut file for `VideoRedo`. Consult comskip documentation for details.<br>
NOTE: Accuracy varies greatly depending on the show. Comskip is most useful to use as an initial guess as to where cut points should be made. Ideally you should then use Womble, VRD or similar editor to adjust the cut points as needed.

===comcut===
  * mencoder is used if you select the “comcut” option in kmttg to automatically cut out commercial segments detected by comskip.
  NOTE: You are better off using an mpeg2 editor if you want precise cuts and in sync audio/video. The combination of comskip and comcut can work well for some shows but not well at all for others. On occasion I find mencoder can produce out of sync audio/video files.<br>
  NOTE: If you have configured VRD and set *output_videoredo=1* in *comskip.ini* then this stage will use `VideoRedo` for doing the video cuts instead of mencoder.

===captions===
  * This option is only enabled on Windows systems and if you have configured full path to `T2Sami` t2extract.exe.
  * This gives you the ability to extract closed captions from `.TiVo` or .mpg files to a .srt file.
  * The file created will have same name as the video file but with .srt suffix.

===encode===
  * Enable this option if you wish to re-encode .mpg files to another format.
  * You should also select the appropriate *Encoding Profile* you want to use for the encode.
  * You can define your own encoding profiles if you wish (see section below on Encoding Profiles).
  NOTE: If *comcut* is enabled then the encoding will be done on `_cut.mpg` file instead of .mpg file.

===custom===
  * You can use this option if you have configured a custom script to run in kmttg configuration. This is always the last task to be performed in the set of enabled tasks and gives you flexibility to do any custom actions you want.

4. Click on *START JOBS* button to start processing all your selections.
   * NOTE: Jobs that are not dependant on each other will run in parallel. Downloads are intentionally limited to 1 download per Tivo so as not to overload your Tivos. Additional downloads are queued up to be performed once the current download completes. Jobs that depend on previous jobs to complete are also queued up.
  * NOTE: kmttg will automatically skip steps based on the presence of files in the output directory. For example, if `.TiVo` file for a show exists kmttg will skip downloading it from the Tivo. If .mpg file for a show exists kmttg will skip the decode phase even if decode is enabled, etc.

5. You can cancel any queued up or running jobs if you wish. Select jobs you wish to cancel in the *JOB MONITOR* and then click on the *CANCEL JOBS* button.
  * NOTE: In general kmttg will not automatically delete partial output files that were being generated by a running job in case you wish to do something with the files, so if you don’t want them you should clean them up. There are options in the configuration setup you can enable to automatically delete files of intermediate tasks such as `.TiVo` files.

==STARTING FROM FILES ON YOUR COMPUTER==
  * The FILES entry is a special TIVO cyclic entry which lets you use kmttg starting from `.TiVo/.mpg/.mpeg` files already downloaded/installed on your computer instead of downloading from your Tivos. If you select this option then 2 buttons will be added to the GUI:
  * *Add...* will bring up a file browser you can use to locate `.TiVo/.mpg/.mpeg` files on your computer you wish to process further with kmttg. Once you select files to add they will be added to the kmttg FILES list.
  * *Remove...* button can be used to remove files you have selected to process in the kmttg FILES list.
  NOTE: This doesn’t remove the files from your computer, simply removes them from the kmttg FILES list.
  * Rest of the flow is very similar to the section above describing *DOWNLOADING FROM TIVOS*.

==ENCODING PROFILES==
Kmttg installation comes with an *encode* folder that contains files with *.enc* suffixes. These files define the entries that are shown in the Encoding Profile cyclic in the main kmttg window. You can create more encoding profiles of your own by adding additional *.enc* files to this folder. Kmttg expects these files to be in a very specific syntax so it’s highly recommended if you create your own file to start with a copy of an existing one.
  * Lines starting with “#” are comments and you can add as many comment lines as you wish since they are ignored.
  * There are 3 keywords that should be present: `<description>, <command>, <extension>`. There should be only 1 line after each.
  * If you require more than 1 command for your encoding then you can make a batch script and define that as the command to be run
  * There are a few uppercase keywords that kmttg understands and will replace with full paths appropriately: *INPUT, OUTPUT, FFMPEG, HANDBRAKE, MENCODER, PERL*

There are comments in the pre-defined *.enc* file which hopefully makes it pretty obvious how to properly define these files.

NOTE: You *MUST* use all lowercase file names with no spaces if creating your own .enc files.

==KMTTG AUTO TRANSFERS==

You have the ability to run kmttg as a background non-graphical program that can automatically download and perform the other usual actions you choose based on titles and keywords you setup.

*NOTE: By default the kmttg Windows service is setup as “automatic” startup mode. This means that should you restart your computer the kmttg service will automatically be started on bootup. If you would like to change this behavior see the relevant section below for more details on how to do that.*

===CONFIGURING AUTO TRANSFERS===
  * *Auto Transfers->Configure…* entry should be use as the first step is to bring up the Auto Transfers Configuration GUI

===Adding title and keyword entries===

You can specify to match shows by title or keyword.

====Title Matching====
Title matching is very simple: supply the exact main title of a show such as ‘lost’, ‘two and a half men’, etc. Note that the title matching is case insensitive so using capital letters is not necessary, however any punctuation should be included.

If you already have shows on your Tivo with titles you wish to add you can more easily do so (outside this GUI) by selecting the entries in the shows list and then using the *Auto Transfers->Add selected titles* menu. Note that when adding entries that way they will default to performing tasks you have enabled in main kmttg window. You can configure and updated each entry individually as needed once they have been added to the auto transfers list.

====Auto Transfer Everything====
If you want kmttg to auto transfer everything available on all your tivos you can setup a title matching entry with simply *{{{.*}}}* as the title (that's 2 characters: a dot followed by an asterisk). In pattern matching this will match anything.

====Keyword Matching====

*NOTE: Keywords will be matched only against show titles, episode titles and descriptions. Extended information such as actors, directors etc. are not included in the search. The reason for this is that extra information is only available as a separate URL for each show, so it would be too network intensive to gather all the extra information for each show.*

You can specify one or more keywords for matching shows.

When you specify a single keyword that means that keyword must be present somewhere in title, episode title or description in order to get a match.

You can setup a more complex keyword match by specifying multiple keywords with different operators:

  * With no parenthesis surrounding a keyword this indicates a logical AND.
  * With (parenthesis) surrounding a keyword this indicates a logical OR.
  * With a ! as the first character in a keyword his indicates a logical NOT.
  * An example is given in the Auto Transfers Configuration GUI as a reminder:
  `(basketball)|(football)|!new york`<br>
  This means match show descriptions that contain either “basketball” or “football” but don’t include any that have “new york”

===Enabling desired options to perform following a download===
Enable which tasks you want to perform following a download for each entry you define. The same options as are available in GUI mode are available here, just make sure kmttg is properly configured as described above. Note that you can define different tasks for each entry and if you are enabling encode task you can use different encoding profiles for each entry.

===ADD===
Once you are happy with an entry setup click this button to add the entry to the setup list. Note that if you click on an entry in the setup list then the form options are updated to match  the setup for that entry.

===UPDATE===
If you want to modify an entry then select the entry in the setup list to display the current configuration for the entry. Then modify configuration as desired and click on the UPDATE button to update the entry.

===DEL===
If you want to remove 1 or more entries then select them in the setup list and click on the DEL button.
 
===GLOBAL SETTING: Check Tivos Interval (mins)===

This defines the interval in minutes for kmttg to check your Tivos for matching shows to download and process. Once matches are found kmttg will automatically download and process all matching shows, then it will sleep for the period of time you define here before checking your Tivos again for more matches. Don’t set this number too low since that will unnecessarily create too much network activity with your Tivos.

===GLOBAL SETTING: Dry Run Mode (test keywords only)===

This option enabled is useful for testing your title and keyword matching setup without actually having kmttg download and process matching shows. Kmttg will simply match your titles and keyword entries versus shows on your Tivo and report which shows match in the *auto.log* file (or if you run in GUI mode you can see matching shows reported in the text area). This mode allows you to quickly test out your setup to make sure you will get the shows you want. Once you have finished debugging obviously this option should be disabled.

===RUNNING AUTO TRANSFERS IN GUI MODE===
  * *Auto Transfers->Run in GUI* menu entries enables you to run auto transfers while in GUI mode so that you can easily monitor what shows are being processed. Note that while this is a convenient way of running and monitoring auto transfers be warned that if you close the kmttg GUI then all actively running jobs will be killed, so don’t use this mode if you plan on terminating the graphical program. If you want to run auto transfers in non-graphical mode consult the sections below.
 
===WORKAROUND FOR REPEATED SHOWS WITH SAME `ProgramId`===

In order to prevent transfer of same show over and over in auto mode kmttg creates an *auto.history* file that contains *`ProgramId`* entries for previously downloaded shows. *`ProgramId`* is usually unique for every show and each episode of a series. However, there are some series where for some reason that is not the case. So for those cases once an episode is downloaded once, no further episodes will download in auto transfers mode because of this issue. To workaround this issue you can setup exceptions for *`ProgramId`* entries where the *auto.history* file will not be checked in auto transfers mode. To do so you must manually edit the *auto.ini* file and add a 2 line entry to bottom of the file as in following example:<br>
`<ignorehistory>`<br>
`SH1940720000`<br>

If you have several such exceptions then add a 2 line entry as in above example for each one.

===RUNNING THE AUTO TRANSFERS PROGRAM AS A SERVICE IN WINDOWS===

*NOTE: running kmttg auto transfers as a service is still experimental and may not work for everyone.*

In Windows the auto transfer program can be setup to run as a Windows Service called kmttg.

Browse to the folder where you installed kmttg and then go to *service\win32* folder. Here there are scripts to install, start, stop or uninstall the kmttg service. For Windows XP simply double-click on the appropriate script to run it. *For Vista these must be run as Administrator in order to work, so you should right click and select "Run as administrator" to run them.*

  * *install-kmttg-service.bat* Installs kmttg as a service
  * *start-kmttg-service.bat* Will start an already installed kmttg service
  * *stop-kmttg-service.bat* Stops a running kmttg service (this doesn’t delete the service, merely stops it)
  * *uninstall-kmttg-service.bat* Deletes the kmttg service such that it won’t automatically start running again upon reboot

NOTE: If you have a service already running from a previous kmttg installation you must uninstall the service using that installation first and then re-install using the new installation.

NOTE: All output messages will be logged in *auto.log* file which resides in the main kmttg installation folder (where kmttg.jar file is located).

For more specific control you can get to the kmttg service in Windows as follows:

  * *Control Panel->Administrative Tools->Services*
  * Scroll down and find *kmttg* entry
  * Right click on *kmttg* and stop service if it is running
  * Right click on kmttg and select *Properties*

===CHANGING KMTTG WINDOWS SERVICE STARTUP MODE===

By default the kmttg service is setup as *automatic* startup mode. This means that should you restart your computer the kmttg service will automatically be started on bootup. If desired you can change the mode to manual (which means you will need to manually start and stop the service and by default the service will not start on bootup) as follows (Windows XP):

  * Control Panel – Administrative Tools – Services
  * Find the kmttg service in the list and right click and select *Properties* and change *Startup Type* to *Manual*
  * Note that you can also stop and start the service from here if you wish

 
===CONTROLLING KMTTG WINDOWS SERVICE FROM COMMAND LINE===

You can control services from the command line using the “sc.exe” command. Examples:

  * sc query kmttg
  * sc start kmttg
  * sc stop kmttg
  * sc delete kmttg

 
===FURTHER DETAILS ON KMTTG WINDOWS SERVICE===

Java scripts cannot natively be run as services in windows. Kmttg uses a windows wrapper program which can interface with Windows services in order to run:

*"<path>\service\win32\bin\wrapper.exe" -s "<path>\service\conf\wrapper.conf"

The *wrapper.conf* files sets up to run Java with *com.tivo.kmttg.main.kmttg -a* as arguments.

The *–a* option to indicates to run kmttg in non graphical auto transfers mode, running in a loop where Tivos are checked and matching shows processed.

 
===SETTING UP KMTTG AUTO TRANSFERS AS A BACKGROUND JOB (MACINTOSH/LINUX)===

On Mac & linux systems you can setup to run kmttg as a background non-graphical job. You need to start kmttg with *-a* argument to do this. You can use the *kmttg* that comes with the installation and simply add -a argument when running it:

*kmttg -a*

If you reboot your system then you will need to re-start the program, or you can use the /etc/rc method to put a script in place that will automatically start the program in background mode with the *–a* option.

 
===RUNNING THE AUTO TRANSFERS PROGRAM AS A BATCH COMMAND===

As an alternative to running auto transfers program as a service, you can alternatively supply the *–b* command line option to kmttg to run batch mode. For example, the command might look something like:

*kmttg –b*

In this mode the program will check your tivos once for matching programs and download and process any matches and then exit.

This is especially useful when used in conjunction with a job scheduler program such as Linux cron.

 
===AUTO TRANSFER RELATED FILES===

There are 3 files associated with auto transfers you should be aware of, all residing in the same directory where the kmttg.pl main program file is located:

====auto.ini====

This file contains your saved auto transfers configuration including any title and keyword matching setups.

NOTE: This file is re-parsed at every Check Tivos Interval so that it is not necessary to re-start the background process whenever you want to update your auto transfer configuration.

====auto.log====

This file contains activity log information for the background process. Entries in the log file all contain a time stamp. You can view this file from kmttg GUI using *Auto Transfers->Examine Log File* menu.

====auto.history====

This file contains a list of `ProgramId` entries for every show that has been processed by the kmttg background process. This is what prevents the same shows from being downloaded over and over again from your Tivos. The `ProgramId` entry is added to this file following a successful download of a show by the kmttg background process. Any shows that are not downloaded are indicated with their associated `ProgramId` entry in the auto.log file.

NOTE: If this file is already created then downloads that complete successfully in GUI mode will also be recorded in the history file such that they will not be re-processed in kmttg background/service mode.

NOTE: You can use *Auto Transfers->Add selected to history file* menu entry to add selected entries in show list to the history file if you wish.